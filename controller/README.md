# Esp32_servo

Коротко: проект прошивки для ESP32, управляющей серво-механизмами и моторами с веб-интерфейсом и поддержкой BLE, датчика давления (BMP180) и фильтра ориентации Madgwick.

## Структура каталогов

- `platformio.ini` — конфигурация PlatformIO для сборки и прошивки.
- `data/` — веб-ресурсы (HTML/CSS/JS), загружаемые во внутреннюю файловую систему ESP (SPIFFS/LittleFS).
- `include/` — заголовочные файлы проекта.
- `lib/ServoESP32/` — библиотека управления серво (включает `examples/`).
- `src/` — исходники прошивки для ESP32.

## Описание модулей

- `src/main.cpp` — точка входа прошивки, инициализация компонентов.
- `src/webserver.cpp` / `include/webserver.h` — встроенный веб-сервер, обслуживающий UI и API.
- `src/motors.cpp` / `include/motors.h` — управление моторами и сервоприводами.
- `src/ble_uart_peripheral.cpp`, `src/ble_uart_central.cpp` / `include/ble_uart_*.h` — BLE UART для связи по Bluetooth.
- `src/bmp180.cpp` / `include/bmp180.h` — работа с датчиком BMP180 (атмосферное давление/температура).
- `src/MadgwickFilter.cpp` / `include/MadgwickFilter.h` — вычисление ориентации с фильтром Madgwick.
- `src/calibration.cpp` — процедуры калибровки (например, датчиков или сервоприводов).
- `src/owl.cpp` / `include/owl.h` — вспомогательные функции/логика (проект-специфично).
- `data/` — пользовательский веб-интерфейс: `index.html`, `web-ui.js`, `camera.js`, `motor-control-sync.js` и другие ресурсы.
- `lib/ServoESP32/src/Servo.cpp`, `lib/ServoESP32/src/Servo.h` — локальная библиотека управления сервоприводом (примеры в `lib/ServoESP32/examples/`).

## Как собрать

Требуется: PlatformIO (VS Code PlatformIO IDE или CLI `pio`).

1) Установите PlatformIO и подключите ESP32 к USB.
2) Собрать прошивку:

```sh
platformio run
```

3) Залить прошивку на устройство:

```sh
platformio run -t upload
```

4) (Если используются веб-ресурсы) Залить содержимое `data/` в файловую систему ESP:

```sh
platformio run -t uploadfs
```

5) Открыть монитор порта (например, чтобы увидеть IP-адрес):

```sh
platformio device monitor -b 115200
```

Заметки:
- Профили сборки и платформа настраиваются в `platformio.ini`.
- Если у вас установлен `pio` вместо `platformio`, используйте `pio` вместо `platformio` в командах.

## Как использовать

1) Подключите ESP32 к компьютеру и загрузите прошивку (см. раздел выше).
2) Загрузите `data/` во внутреннюю FS, если веб-интерфейс нужен локально.
3) Откройте последовательный монитор — устройство обычно выводит лог и IP-адрес точки доступа/клиента.
4) В браузере перейдите по IP-адресу, указанному в логах (или используйте точку доступа, если реализовано).
5) Веб-интерфейс позволяет управлять положением сервоприводов, остановкой/запуском моторов и отправкой команд по BLE/WEB.

Дополнительно:
- Примеры использования сервоприводов находятся в `lib/ServoESP32/examples/`.
- Для отладки датчиков и калибровки используйте `src/calibration.cpp` и последовательный вывод.

## Полезные файлы

- `platformio.ini` — конфигурация сборки и флеш-параметры.
- `data/index.html` и `data/web-ui.js` — веб-интерфейс клиента.
- `src/webserver.cpp` — обработка HTTP-запросов и маршрутов API.

## Что дальше / советы

- Если планируете модифицировать веб-интерфейс, правьте файлы в `data/` и выполняйте `platformio run -t uploadfs`.
- Для добавления новых сервоприводов используйте `lib/ServoESP32` как отправную точку.

## Лицензия

Основной репозиторий содержит файл `LICENSE` в корне проекта.
# Esp32_servo